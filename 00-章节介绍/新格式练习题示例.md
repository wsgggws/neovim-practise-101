# Neovim 实战 - 新格式练习题示例

> 本文件包含 5 种全新题型的完整示例，每种 2-3 道练习题

---

# 题型一：对比题

## 对比题 01：复制整行的两种方式

> 难度：⭐ | 类型：对比题 | 预估时间：1 分钟 | 分类：复制粘贴

### 场景描述

在日常开发中，经常需要快速复制当前行。这道题对比两种常用方法，帮助你理解它们的适用场景。

### 初始状态

```text
1. 第一行
2. 第二行 ← 光标在这里
3. 第三行
```

### 目标状态

```text
1. 第一行
2. 第二行
2. 第二行 ← 复制品
3. 第三行
```

---

### 解法对比

| 解法  | 命令  | 按键次数 | 优点                   | 缺点         |
| ----- | ----- | -------- | ---------------------- | ------------ |
| **A** | `yyp` | 3        | 简单直观，无需切换模式 | 仅限当前行   |
| **B** | `:t.` | 4        | 可指定任意行范围       | 需要输入冒号 |

---

### 推荐解法

```vim
yyp
```

**操作分解：**

| 按键 | 作用 |
|------|------|
| `yy` | 复制当前行到寄存器 |
| `p` | 粘贴到光标下方 |

---

### 备选解法

```vim
:t.
```

**操作分解：**

| 按键 | 作用 |
|------|------|
| `:` | 进入命令行模式 |
| `.` | 当前行位置 |
| `t` | copy to（复制到） |

---

### 深度对比

**`yyp` vs `:t.`**

| 对比项   | `yyp`                        | `:t.`                              |
| -------- | ---------------------------- | ---------------------------------- |
| 模式切换 | Normal 模式直接操作          | 需要进入命令行                     |
| 寄存器   | 使用默认寄存器（可粘贴多次） | 直接复制，不经过寄存器             |
| 范围操作 | 仅限当前行                   | 可指定 `:1t5` 复制 1 行到第 5 行后 |

**使用场景：**

- 快速复制 1 行 → 用 `yyp`
- 复制特定行 → 用 `:t n`
- 复制多行 → 用 `:m,n t k`

---

### 进阶扩展

**复制到其他位置：**

```vim
" 复制当前行到第 10 行后
:10t.

" 复制当前行到文件末尾
:t$

" 复制当前行到文件开头
:0t.
```

---

### 常见错误

- ❌ **`yyP`** → 复制后粘贴到上方（位置错误）
- ✅ **`yyp`** → 复制后粘贴到下方（正确）

---

### 视频时间点

- **0:00** - 题目介绍
- **0:20** - 解法 A 演示
- **0:45** - 解法 B 演示
- **1:15** - 深度对比分析
- **1:45** - 进阶扩展

---

### 检验清单

- [ ] 理解两种解法的原理
- [ ] 知道什么场景用哪个
- [ ] 能在 5 秒内完成

---

## 对比题 02：删除到行尾的两种方式

> 难度：⭐ | 类型：对比题 | 预估时间：1 分钟 | 分类：删除操作

### 场景描述

删除光标到行尾的内容是高频操作，对比 `D` 和 `d$` 两种写法。

### 初始状态

```python
def hello(name):
    print(f"Hello, {name}")  ← 光标在 { 后面
```

### 目标状态

```python
def hello(name):
    print(f"Hello, ")
```

---

### 解法对比

| 解法  | 命令 | 按键次数 | 记忆难度         |
| ----- | ---- | -------- | ---------------- |
| **A** | `D`  | 1        | 简单（单字符）   |
| **B** | `d$` | 2        | 直观（d + 动作） |

---

### 推荐解法

```vim
D
```

---

### 备选解法

```vim
d$
```

---

### 深度对比

| 对比项   | `D`              | `d$`              |
| -------- | ---------------- | ----------------- |
| 原理     | `d` + `$` 的缩写 | 明确的操作 + 动作 |
| 可组合性 | 独立命令         | 可与其他操作组合  |

**为什么 `D` 是缩写？**

Vim 中大写命令通常是对应小写的「到行尾」版本：

- `C` = `c$`（修改到行尾）
- `S` = `^c`（修改整行）
- `A` = `$a`（在行尾插入）

---

### 进阶扩展

```vim
" 删除到下一个单词开头
dW

" 删除到文件末尾
dG

" 删除整行（到下一行开头）
D
```

---

### 检验清单

- [ ] 理解 `D` 和 `d$` 的关系
- [ ] 知道 Vim 的命令缩写规则
- [ ] 能解释为什么 `D` 更高效

---

# 题型二：纠错题

## 纠错题 01：diw vs daw

> 难度：⭐⭐ | 类型：纠错题 | 预估时间：1 分钟 | 分类：文本对象

### 场景描述

你想删除一个单词，但发现结果和你想的不一样？

### 初始状态

```text
hello world neovim
      ↑ 光标在 w 上面
```

---

### 错误操作

```vim
daw
```

### 错误结果

```text
hello neovim
```

**问题：** 只剩一个空格了！

---

### 正确操作

```vim
diw
```

### 正确结果

```text
hello world neovim
     ↑ 光标位置，world 被删除但空格保留
```

---

### 问题分析

| 操作  | 删除内容    | 保留内容 | 结果            |
| ----- | ----------- | -------- | --------------- |
| `diw` | inside word | 空格 ×2  | `hello  neovim` |
| `daw` | a word      | 无       | `hello neovim`  |

---

### 为什么是错的？

**`diw` = delete inside word**

- 删除「单词内部」
- 保留前后空格

**`daw` = delete a word**

- 删除「一个单词」
- 同时删除前导空格

---

### 使用场景选择

| 场景               | 操作  | 原因         |
| ------------------ | ----- | ------------ |
| 删除单词，保留空格 | `diw` | 保持格式     |
| 删除单词及后面空格 | `daw` | 清理多余空格 |
| 删除单词及前后空格 | `daw` | 完全移除     |

---

### 举一反三

```vim
" 修改时保留空格
ciwnew<Esc>

" 修改时删除整个单词（含空格）
cawnew<Esc>

" 复制时保留空格
yiw
```

---

### 常见错误

- ❌ 在代码中使用 `daw` 导致格式混乱
- ✅ 根据需求选择正确的文本对象

---

### 检验清单

- [ ] 理解 `i`（inside）和 `a`（a）的区别
- [ ] 能根据场景选择正确的文本对象
- [ ] 不再犯类似错误

---

## 纠错题 02：cw vs ciw

> 难度：⭐⭐ | 类型：纠错题 | 预估时间：1 分钟 | 分类：修改操作

### 场景描述

你想修改一个单词，发现光标位置影响结果？

### 初始状态

```text
hello world
      ↑ 光标在 w 上面
```

---

### 错误操作

```vim
cworld<Esc>
```

### 错误结果

```text
hello worldnew
```

**问题：** 只修改了部分字符！

---

### 正确操作

```vim
ciwnew<Esc>
```

### 正确结果

```text
hello new
```

---

### 问题分析

| 操作  | 修改范围         | 结果       |
| ----- | ---------------- | ---------- |
| `cw`  | 从光标到单词结尾 | `worldnew` |
| `ciw` | 整个单词         | `new`      |

---

### 为什么是错的？

**`cw` = change word**

- 从**当前位置**到单词结尾
- 不包含整个单词

**`ciw` = change inside word**

- 整个单词内部
- 与光标位置无关

---

### 记忆技巧

```
cw = 从光标位置开始修改到单词结尾
ciw = 修改整个单词（不关心光标位置）
```

---

### 适用场景

| 场景             | 操作                 | 原因 |
| ---------------- | -------------------- | ---- |
| 光标在单词开头   | `cw` 或 `ciw` 都可以 |
| 光标在单词中间   | 用 `ciw` 更安全      |
| 只想修改后半部分 | 用 `cw`              |

---

### 检验清单

- [ ] 理解 `cw` 和 `ciw` 的区别
- [ ] 知道光标位置如何影响 `cw`
- [ ] 能正确选择操作方式

---

# 题型三：组合题

## 组合题 01：把多行变成列表

> 难度：⭐⭐ | 类型：组合题 | 预估时间：2 分钟 | 分类：格式转换

### 场景描述

把用逗号分隔的多个值转换为 Markdown 列表格式。

### 初始状态

```text
apple, banana, cherry, date
```

### 目标状态

```markdown
- apple
- banana
- cherry
- date
```

---

### 思路分析

这道题需要：

1. **分割** - 把逗号分隔变成行分隔
2. **替换** - 在行首添加 `-`
3. **清理** - 去除多余空格

---

### 解法步骤

**方案 A：substitute 组合（推荐）**

```vim
:s/, /\r/g
V
:s/^/-
```

**方案 B：外部命令**

```vim
:!echo "apple, banana, cherry, date" | tr ',' '\n' | sed 's/^/- /'
```

**方案 C：宏录制**

```vim
qa
f,      " 找到逗号
s,<Esc> " 替换为空格加换行
j0      " 下一行行首
q
3@a     " 执行 3 次
I-<Esc> " 行首添加 -
```

---

### 方案 A 详解

**步骤 1：分割逗号**

```vim
:s/, /\r/g
```

| 部分 | 含义             |
| ---- | ---------------- |
| `:`  | 进入命令行       |
| `s`  | substitute       |
| `,` | 逗号+空格        |
| `\r` | 换行符           |
| `g`  | 全局（所有匹配） |

**中间状态：**

```text
apple
 banana
 cherry
 date
```

**步骤 2：清理空格（可选）**

```vim
:%s/^ //
```

**步骤 3：添加列表标记**

```vim
:%s/^/- /
```

---

### 命令组合解析

| 步骤 | 命令         | 作用             |
| ---- | ------------ | ---------------- |
| 1    | `:s/, /\r/g` | 逗号分隔转行分隔 |
| 2    | `:%s/^ //`   | 删除行首空格     |
| 3    | `:%s/^/- /`  | 添加列表标记     |

---

### 效率对比

| 方案 | 按键次数  | 可读性 | 扩展性 |
| ---- | --------- | ------ | ------ |
| A    | ~15       | ⭐⭐⭐ | ⭐⭐   |
| B    | ~20       | ⭐⭐   | ⭐⭐⭐ |
| C    | ~10 + n@q | ⭐⭐   | ⭐     |

---

### 进阶扩展

**带序号的列表：**

```vim
:%s/^/\=(line('.')) . '. '
```

**多行列表（每行多个值）：**

```vim
:g/^./if line('.') != line('$') | s/, /,\r/g | endif
```

---

### 检验清单

- [ ] 能分析任务，拆分成多个步骤
- [ ] 知道每个步骤用什么命令
- [ ] 能选择最高效的方案

---

## 组合题 02：重构代码中的魔法数字

> 难度：⭐⭐ | 类型：组合题 | 预估时间：3 分钟 | 分类：代码重构

### 场景描述

有一段代码使用了很多魔法数字，需要提取成常量。

### 初始状态

```python
def calculate_price(base, quantity):
    discount_rate = 0.15
    tax_rate = 0.08
    return base * quantity * (1 - discount_rate) * (1 + tax_rate)
```

### 目标状态

```python
DISCOUNT_RATE = 0.15
TAX_RATE = 0.08

def calculate_price(base, quantity):
    discount_rate = DISCOUNT_RATE
    tax_rate = TAX_RATE
    return base * quantity * (1 - discount_rate) * (1 + tax_rate)
```

---

### 思路分析

1. 在文件开头添加常量定义
2. 把 `0.15` 替换为 `DISCOUNT_RATE`
3. 把 `0.08` 替换为 `TAX_RATE`

---

### 解法步骤

**步骤 1：添加常量定义**

```vim
ggO
DISCOUNT_RATE = 0.15
TAX_RATE = 0.08
<Esc>
```

**步骤 2：替换第一个数字**

```vim
/0\.15<Enter>
cwDISCOUNT_RATE<Esc>
```

**步骤 3：替换第二个数字**

```vim
/0\.08<Enter>
cwTAX_RATE<Esc>
```

**步骤 4：调整格式（添加空行）**

```vim
/discount_rate = DISCOUNT_RATE<Enter>
O<Esc>
```

---

### 更高效的方法

**使用 substitute + 变量：**

```vim
:let @d='DISCOUNT_RATE'
:let @t='TAX_RATE'
:%s/0\.15/\=@d/g
:%s/0\.08/\=@t/g
```

**使用宏批量操作：**

```vim
" 录制替换宏
qa
/0\.<Enter>
cwiDISCOUNT_RATE<Esc>
n
cwiTAX_RATE<Esc>
q
```

---

### 检验清单

- [ ] 能识别代码中的重构机会
- [ ] 掌握变量替换的多种方法
- [ ] 能保持代码格式整洁

---

# 题型四：挑战题

## 挑战题 01：100 行代码批量修改

> 难度：⭐⭐⭐ | 类型：挑战题 | 预估时间：5 分钟 | 分类：批量操作

### 场景描述

有 100 行类似的 JSON 对象需要转换为另一种格式。

### 初始状态

```json
{"name": "apple", "price": 1}
{"name": "banana", "price": 2}
{"name": "cherry", "price": 3}
{"name": "date", "price": 4}
... 共 100 行
```

### 目标状态

```json
{
  "name": "apple",
  "price": 1
},
{
  "name": "banana",
  "price": 2
},
{
  "name": "cherry",
  "price": 3
},
{
  "name": "date",
  "price": 4
}
```

---

### 挑战要求

1. **最少的按键次数**
2. **最清晰的思路**
3. **最不容易出错**

---

### 参考解法

**解法 A：substitute（最简洁）**

```vim
:%s/},/},\r{/g
```

**解法 B：列编辑**

```vim
" 步骤 1：进入列选
Ctrl-v

" 步骤 2：选中所有行
99j

" 步骤 3：行首添加 {
I{<Esc>

" 步骤 4：行尾添加 }
A},<Esc>
```

**解法 C：global 命令**

```vim
:g/^/s/}$/},\r{/gi
```

---

### 效率排名

| 解法 | 按键次数 | 可读性 | 可维护性 |
| ---- | -------- | ------ | -------- |
| A    | ~8       | ⭐⭐⭐ | ⭐⭐⭐   |
| B    | ~15      | ⭐⭐⭐ | ⭐⭐     |
| C    | ~10      | ⭐⭐   | ⭐⭐⭐   |

---

### 思考题

1. 如果需求变成「只修改前 50 行」怎么办？

   ```vim
   :1,50s/},/},\r{/g
   ```

2. 如果需要格式化整个 JSON 呢？

   ```vim
   :%!jq .
   ```

3. 如何验证修改正确？

   ```vim
   :%!python -m json.tool
   ```

---

### 检验清单

- [ ] 能想出至少两种解法
- [ ] 能分析各解法的优劣
- [ ] 能根据场景选择最优解

---

## 挑战题 02：把函数改成箭头函数

> 难度：⭐⭐⭐ | 类型：挑战题 | 预估时间：5 分钟 | 分类：代码转换

### 场景描述

把 JavaScript 普通函数转换为箭头函数。

### 初始状态

```javascript
function multiply(a, b) {
  return a * b;
}

function greet(name) {
  console.log("Hello, " + name);
  return "Hello!";
}

function add(a, b) {
  var result = a + b;
  return result;
}
```

### 目标状态

```javascript
const multiply = (a, b) => {
  return a * b;
};

const greet = (name) => {
  console.log("Hello, " + name);
  return "Hello!";
};

const add = (a, b) => {
  var result = a + b;
  return result;
};
```

---

### 挑战要求

1. 只用 Vim 命令完成
2. 尽量减少按键次数
3. 保持代码逻辑不变

---

### 推荐解法

**步骤 1：转换函数声明**

```vim
:%s/function \(\w*\)(/\1 = (/g
:%s/) {$/) => {/g
```

**步骤 2：添加 const 声明**

```vim
:%s/^const \zs\(\w*\)/const \1 = /g
```

---

### 分步演示

**原始：**

```javascript
function multiply(a, b) {
```

**步骤 1 后：**

```javascript
multiply = (a, b) => {
```

**步骤 2 后：**

```javascript
const multiply = (a, b) => {
```

---

### 思考题

1. 如果有 500 个函数怎么办？
2. 如何处理有返回类型的 TypeScript 函数？
3. 如何区分普通函数和类方法？

---

### 检验清单

- [ ] 能用正则处理多行代码
- [ ] 理解 Vim 的 substitute 高级用法
- [ ] 能处理各种边界情况

---

# 题型五：思维训练题

## 思维训练 01：理解 Vim 的编辑哲学

> 难度：⭐⭐ | 类型：思维训练 | 预估时间：5 分钟 | 分类：原理理解

### 问题 1：动词 + 名词

Vim 的命令遵循「动词 + 名词」模式：

| 动词 | 含义           |
| ---- | -------------- |
| `d`  | delete（删除） |
| `c`  | change（修改） |
| `y`  | yank（复制）   |
| `v`  | visual（可视） |

| 名词（文本对象） | 含义                        |
| ---------------- | --------------------------- |
| `iw`             | inner word（单词内部）      |
| `i"`             | inner quotes（引号内部）    |
| `ip`             | inner paragraph（段落内部） |
| `as`             | a sentence（一个句子）      |

**组合练习：**

| 命令  | 解释       |
| ----- | ---------- |
| `diw` | 删除单词   |
| `ciw` | 修改单词   |
| `yi"` | 复制引号内 |
| `yip` | 复制段落   |

**思考题 1-1：** 如果要「删除引号内的内容，但保留引号」，应该用什么？

<details>
<summary>答案</summary>

`di"` - delete inside quotes

</details>

---

### 问题 2：操作 + 动作

命令也可以「操作 + 动作」：

| 动作 | 含义       |
| ---- | ---------- |
| `$`  | 到行尾     |
| `0`  | 到行首     |
| `gg` | 到文件开头 |
| `G`  | 到文件结尾 |
| `w`  | 下个单词   |
| `b`  | 上个单词   |

**组合练习：**

| 命令  | 解释           |
| ----- | -------------- |
| `d$`  | 删除到行尾     |
| `d0`  | 删除到行首     |
| `dgg` | 删除到文件开头 |
| `dw`  | 删除到下个单词 |

**思考题 2-1：** 如果光标在第 5 行，要删除第 1-5 行，应该用什么？

<details>
<summary>答案</summary>

`d1G` 或 `dgg`

</details>

**思考题 2-2：** 如果要删除到下一个段落开头呢？

<details>
<summary>答案</summary>

`dap` - delete a paragraph

</details>

---

### 问题 3：为什么 Vim 这样设计？

**思考题 3-1：** 为什么删除单词是 `diw` 而不是 `dw`？

<details>
<summary>答案</summary>

因为 `dw` = delete word，它删除从光标位置到下一个单词**开头**，而不是整个单词。`diw` 确保删除完整的、与光标位置无关的单词。

</details>

**思考题 3-2：** 为什么 `dd` 可以直接删除整行，不需要加名词？

<details>
<summary>答案</summary>

`dd` 是特殊的「整行操作」命令，是 Vim 内置的快捷方式。同样 `cc` 修改整行，`yy` 复制整行。它们是最常用的操作，所以有专门的快捷方式。

</details>

---

### 问题 4：举一反三

| 普通版 | 完整版     | 说明                          |
| ------ | ---------- | ----------------------------- |
| `dw`   | `diw`      | 删除到下个单词 / 删除整个单词 |
| `dd`   | 已经是整行 | 无需完整版                    |
| `cc`   | 已经是整行 | 无需完整版                    |
| `cw`   | `ciw`      | 修改到词尾 / 修改整个词       |

**思考题 4-1：** `daw` 和 `diw` 的区别是什么？

<details>
<summary>答案</summary>

- `diw` = delete inside word（删除单词内部，保留空格）
- `daw` = delete a word（删除一个单词，包括后面空格）

</details>

---

### 检验清单

- [ ] 理解「动词 + 名词」模式
- [ ] 理解「操作 + 动作」模式
- [ ] 能推断新命令的含义
- [ ] 知道什么时候用完整版，什么时候用缩写

---

## 思维训练 02：光标移动的逻辑

> 难度：⭐⭐ | 类型：思维训练 | 预估时间：5 分钟 | 分类：移动导航

### 问题 1：理解相对移动

Vim 有两种行号显示方式：

| 模式     | 命令                  | 说明            |
| -------- | --------------------- | --------------- |
| 绝对行号 | `:set number`         | 显示 1, 2, 3... |
| 相对行号 | `:set relativenumber` | 显示 0, 1, 2... |

**思考题 1-1：** 光标在第 10 行，相对行号显示 `0`。如果要到第 15 行，应该按什么？

<details>
<summary>答案</summary>

`5j` 或 `5<Down>` 或 `:15<Enter>`

</details>

**思考题 1-2：** 光标在第 10 行，相对行号显示 `0`。如果要到第 5 行，应该按什么？

<details>
<summary>答案</summary>

`5k` 或 `5<Up>` 或 `5-` 或 `:5<Enter>`

</details>

---

### 问题 2：f 和 t 的区别

| 命令      | 含义               | 光标位置 |
| --------- | ------------------ | -------- |
| `f{char}` | find，到下一个字符 | 字符上   |
| `t{char}` | till，到字符前     | 字符前   |
| `F{char}` | find，反向         | 字符上   |
| `T{char}` | till，反向         | 字符前   |

**示例：**

```text
hello, world!
           ↑
           光标在这里
```

- `f!` → 光标在 `!` 上
- `t!` → 光标在 `d` 上

**思考题 2-1：** 要删除 `world` 后面的逗号，光标在 `w`，应该用什么？

<details>
<summary>答案</summary>

`f,` 然后 `x`（删除逗号）

或 `t,x`（till 逗号然后删除）

</details>

---

### 问题 3：为什么需要多种移动方式？

**思考题 3-1：** 下面两种方式，哪种更适合跳转到 10 行后的位置？

A. 按 10 次 `j`
B. `10j`
C. `:15<Enter>`

<details>
<summary>答案</summary>

- 短距离（1-3 行）：`j` / `k`
- 中等距离（5-20 行）：`n j`（如 `10j`）
- 远距离（20+ 行）：`:n`（如 `:100<Enter>`）

</details>

---

### 检验清单

- [ ] 理解相对行号的含义
- [ ] 区分 `f` 和 `t` 的用法
- [ ] 能根据距离选择合适的移动方式

---

# 附录：完整练习答案

## 对比题答案

### 对比题 01

- 推荐：`yyp`
- 备选：`:t.`

### 对比题 02

- 推荐：`D`
- 备选：`d$`

---

## 纠错题答案

### 纠错题 01

- 错误：`daw`
- 正确：`diw`

### 纠错题 02

- 错误：`cw`
- 正确：`ciw`

---

## 组合题答案

### 组合题 01

```vim
:s/, /\r/g
:%s/^ //
:%s/^/- /
```

### 组合题 02

```vim
:let @d='DISCOUNT_RATE'
:let @t='TAX_RATE'
:%s/0\.15/\=@d/g
:%s/0\.08/\=@t/g
```

---

## 挑战题答案

### 挑战题 01

```vim
:%s/},/},\r{/g
```

### 挑战题 02

```vim
:%s/function \(\w*\)(/\1 = (/g
:%s/) {$/) => {/g
```

---

## 思维训练答案

### 思维训练 01

| 问题 | 答案                           |
| ---- | ------------------------------ |
| 1-1  | `di"`                          |
| 2-1  | `d1G` 或 `dgg`                 |
| 2-2  | `dap`                          |
| 3-1  | `dw` 删除到下个单词开头        |
| 3-2  | 整行操作有快捷方式             |
| 4-1  | `diw` 保留空格，`daw` 删除空格 |

### 思维训练 02

| 问题 | 答案           |
| ---- | -------------- |
| 1-1  | `5j`           |
| 1-2  | `5k`           |
| 2-1  | `f,x` 或 `t,x` |
| 3-1  | 根据距离选择   |

---

> **提示**：建议先自己思考，再查看答案。
