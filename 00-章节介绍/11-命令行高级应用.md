# 第 11 章：命令行高级应用

> 本章涵盖 166-181 题，学习 Ex 命令的高级用法。

## 核心技能

| 技能       | 命令      | 说明         |
| ---------- | --------- | ------------ |
| 全局命令   | `:g`      | 匹配行执行   |
| 反向全局   | `:v`      | 不匹配执行   |
| 范围指定   | `:'<,'>`  | 可视区域     |
| 宏与寄存器 | `:normal` | 执行普通命令 |

## 学习路径

```
第 1 周：范围与全局 (166-170)
第 2 周：命令行寄存器 (171-174)
第 3 周：函数与脚本 (175-178)
第 4 周：多文件操作 (179-181)
```

## 关键命令速查

```vim
" 范围指定
:1,10        " 1 到 10 行
:%           " 全文
:.           " 当前行
:$           " 最后一行
:'<,'>       " 可视选区

" 全局命令
:g/pattern/cmd     " 匹配执行
:v/pattern/cmd     " 不匹配执行

" 常用组合
:g/^$/d            " 删除空行
:v/\d/d            " 删除无数字行
:g/pattern/y A     " 复制到寄存器

" 命令行寄存器
:put =getline('.') " 插入当前行内容
:normal Ixxx       " 批量插入
@:                 " 重复上次命令行
```

## 高级用法

```vim
" 复杂全局命令
:g/pattern/s/old/new/g

" 条件执行
:g/pattern/if getline('.') =~ 'xxx' | s/xxx/yyy/ | endif

" 多文件操作
:args *.txt
:argdo %s/xxx/yyy/g | update

" 使用外部命令
:%!python -m json.tool
:%!sort
:%!uniq
```

## 常见场景

1. **批量替换**：跨多行统一修改
2. **数据提取**：收集匹配行
3. **格式转换**：管道外部工具
4. **多文件处理**：argdo

## 脚本函数

```vim
function! MyFunc()
    let l:count = line('$')
    echo "Lines: " . l:count
endfunction

command! MyCommand call MyFunc()
```

## 视频时间点

- **0:00** - 本章介绍
- **0:30** - 范围与全局
- **1:00** - 命令行寄存器
- **1:30** - 函数与脚本
- **2:00** - 多文件操作
- **2:30** - 综合实战
