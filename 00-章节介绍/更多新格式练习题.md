# Neovim 实战 - 更多新格式练习题

> 本文件包含更多新格式练习题，可直接用于视频分享

---

# 第一部分：对比题（3道）

## 对比题 03：可视模式的两种进入方式

> 难度：⭐ | 类型：对比题 | 预估时间：1 分钟 | 分类：可视模式

### 场景描述

需要选中一段文本进行操作，对比字符可视、行可视、列可视的区别。

### 初始状态

```python
def hello():
    print("Hello")
    return True
```

---

### 解法对比

| 解法         | 命令     | 适用场景           |
| ------------ | -------- | ------------------ |
| **字符可视** | `v`      | 选中任意范围的字符 |
| **行可视**   | `V`      | 选中整行           |
| **列可视**   | `Ctrl-v` | 选中多行的同一列   |

---

### 推荐解法

**根据场景选择：**

```vim
" 选中 3 行（整行操作）
Vjj

" 选中单词（字符操作）
viw

" 选中多行同一列（列编辑）
Ctrl-v jj
```

---

### 深度对比

| 对比项   | `v`      | `V`    | `Ctrl-v` |
| -------- | -------- | ------ | -------- |
| 选中单位 | 字符     | 行     | 列       |
| `o` 切换 | 首尾     | 首尾   | 角点     |
| 典型操作 | 复制部分 | 复制行 | 列编辑   |

**切换方法：**

- `v` → `V`：再按一次 `v`
- `V` → `Ctrl-v`：再按一次 `v`
- `Ctrl-v` → `v`：再按一次 `v`

---

### 常见错误

- ❌ 想选中列却用了 `v`，导致选中整行
- ✅ 先确认要选中的单位，再选择合适的可视模式

---

### 检验清单

- [ ] 知道三种可视模式的区别
- [ ] 能根据场景选择正确的模式
- [ ] 知道如何切换可视模式

---

## 对比题 04：单引号 vs 双引号

> 难度：⭐ | 类型：对比题 | 预估时间：1 分钟 | 分类：文本对象

### 场景描述

在字符串中使用单引号和双引号的场景。

### 初始状态

```javascript
const msg = "Hello World";
```

---

### 解法对比

| 解法    | 命令  | 说明         |
| ------- | ----- | ------------ |
| **ci"** | `ci"` | 修改双引号内 |
| **ci'** | `ci'` | 修改单引号内 |

---

### 深度对比

**都适用的情况：**

```javascript
const msg = "Hello World";
           ↑ 光标在引号内

ci'Hello'<Esc>
// 结果：const msg = 'Hello';
```

**不同之处：**

| 场景         | 用双引号 | 用单引号 |
| ------------ | -------- | -------- |
| 字符串含 `"` | `ci"`    | `ci'`    |
| 字符串含 `'` | `ci"`    | `ci'`    |
| HTML 属性    | `ci"`    | -        |

---

### 进阶技巧

**自动切换引号：**

```vim
" 把双引号改成单引号
:%s/"/'/g
```

**处理嵌套引号：**

```javascript
const sql = "SELECT * FROM users WHERE name = 'John'";
```

需要先改外层，再改内层。

---

### 检验清单

- [ ] 知道 `ci"` 和 `ci'` 的区别
- [ ] 能处理嵌套引号场景
- [ ] 知道何时用哪种引号

---

## 对比题 05：/ 和 ? 搜索

> 难度：⭐ | 类型：对比题 | 预估时间：1 分钟 | 分类：搜索导航

### 场景描述

在文件中搜索目标，对比向下搜索和向上搜索。

### 初始状态

```text
line 1
line 2
line 3
line 4
line 5
```

光标在第 3 行

---

### 解法对比

| 解法         | 命令    | 搜索方向          |
| ------------ | ------- | ----------------- |
| **/pattern** | `/line` | 向下（第 4-5 行） |
| **?pattern** | `?line` | 向上（第 1-2 行） |

---

### 推荐解法

**向下搜索：**

```vim
/line
n  " 下一个匹配
n  " 继续
```

**向上搜索：**

```vim
?line
n  " 上一个匹配
N  " 反向继续
```

---

### 深度对比

| 对比项   | `/`      | `?`      |
| -------- | -------- | -------- |
| 方向     | 向下     | 向上     |
| `n` 行为 | 继续向下 | 继续向上 |
| `N` 行为 | 反向     | 反向     |

**搜索历史：**

```vim
q/  " 打开搜索历史窗口
q?  " 同上
```

---

### 进阶技巧

**搜索当前词：**

```vim
*  " 向下搜索光标所在词
#  " 向上搜索光标所在词
```

**搜索并替换：**

```vim
:/pattern/s/old/new/g  " 从当前位置向下替换
:?pattern/s/old/new/g  " 从当前位置向上替换
```

---

### 检验清单

- [ ] 知道 `/` 和 `?` 的区别
- [ ] 理解 `n` 和 `N` 的行为
- [ ] 会使用 `*` 和 `#`

---

# 第二部分：纠错题（3道）

## 纠错题 03：% 匹配括号

> 难度：⭐⭐ | 类型：纠错题 | 预估时间：1 分钟 | 分类：导航

### 场景描述

你想跳转到匹配的括号，但结果不对？

### 初始状态

```python
def hello(name: str) -> str:
    if name:
        return f"Hello, {name}"
    return "Hello"
```

光标在 `(` 上

---

### 错误操作

```vim
%
```

### 错误结果

跳转到文件末尾或其他位置

---

### 正确操作

```vim
%
```

### 正确结果

跳转到匹配的 `)` 上

---

### 问题分析

**`%` 能匹配：**

- `()` 圆括号
- `[]` 方括号
- `{}` 花括号
- `#if` / `#endif`（C 预处理器）
- `/*` / `*/`（C 注释）

**`%` 不能匹配：**

- 单引号 `'`
- 双引号 `"`
- HTML 标签 `<div>`

---

### 为什么可能出错？

| 情况           | 结果                 |
| -------------- | -------------------- |
| 光标不在括号上 | 可能跳到意外位置     |
| 括号不匹配     | 跳到最近的可匹配位置 |
| 嵌套括号       | 只跳到外层配对       |

---

### 使用技巧

```vim
%  " 跳到匹配括号
%  " 再按一次跳回来

" 选中括号内内容
v%  " 可视模式选中
```

---

### 检验清单

- [ ] 理解 `%` 的工作原理
- [ ] 知道 `%` 能匹配哪些符号
- [ ] 知道 `%` 的限制

---

## 纠错题 04：u 和 Ctrl-r 撤销重做

> 难度：⭐ | 类型：纠错题 | 预估时间：1 分钟 | 分类：撤销操作

### 场景描述

你撤销了操作，想要恢复，但撤销没反应？

### 操作步骤

```vim
dd      " 删除一行（消失了）
u       " 撤销（恢复了）
Ctrl-r  " 重做（？）
```

---

### 常见错误

**错误理解：**

- ❌ 认为 `u` 可以无限撤销
- ❌ 认为 `Ctrl-r` 可以恢复所有撤销

**正确理解：**

- `u` = 撤销上一次更改
- `Ctrl-r` = 重做上一次撤销

---

### 为什么可能出错？

**场景 1：**

```vim
dd    " 删除
u     " 恢复
u     " 再次撤销（不是重做！）
```

**场景 2：**

```vim
dd    " 删除
u     " 恢复
iabc<Esc>  " 新编辑
Ctrl-r  " 不能恢复之前的删除！
```

**新编辑会清除重做栈！**

---

### 使用技巧

**查看撤销树：**

```vim
" Gundo 插件
<leader>u
```

**恢复特定状态：**

```vim
:earlier 10m  " 回退到 10 分钟前
:later 5s     " 前进到 5 秒后
```

---

### 检验清单

- [ ] 理解 `u` 和 `Ctrl-r` 的区别
- [ ] 知道新编辑会清除重做栈
- [ ] 会使用 `:earlier`/`:later`

---

## 纠错题 05：i 和 a 的区别

> 难度：⭐⭐ | 类型：纠错题 | 预估时间：2 分钟 | 分类：插入模式

### 场景描述

你想在括号内插入内容，但结果在括号外？

### 初始状态

```python
print()
        ↑ 光标在括号内
```

---

### 错误操作

```vim
anew content<Esc>
```

### 错误结果

```python
print(new content)
           ↑ 在 ) 后面
```

---

### 正确操作

```vim
inew content<Esc>
```

### 正确结果

```python
print(new content)
          ↑ 在括号内
```

---

### 问题分析

| 命令 | 含义   | 光标位置       |
| ---- | ------ | -------------- |
| `i`  | insert | 当前字符**前** |
| `a`  | append | 当前字符**后** |

**示例：**

```text
hello|
```

- `i` → `he|llo`（在 e 后）
- `a` → `hell|o`（在 l 后）

---

### 为什么是错的？

在 `print()` 中，光标在 `)` 上：

- `a` = 在 `)` **后**插入 → 结果 `print()content)`
- `i` = 在 `)` **前**插入 → 结果 `print(content)`

---

### 使用场景

| 场景       | 操作 | 原因         |
| ---------- | ---- | ------------ |
| 括号内插入 | `i`  | 在括号字符前 |
| 括号后插入 | `a`  | 在括号字符后 |
| 行尾插入   | `A`  | 等同于 `$a`  |
| 行首插入   | `I`  | 等同于 `0i`  |

---

### 检验清单

- [ ] 理解 `i` 和 `a` 的区别
- [ ] 知道 `I` 和 `A` 的快捷方式
- [ ] 能根据位置选择正确的插入方式

---

# 第三部分：组合题（3道）

## 组合题 03：把 JSON 改成 JS 对象

> 难度：⭐⭐ | 类型：组合题 | 预估时间：3 分钟 | 分类：格式转换

### 场景描述

把 JSON 格式转换为 JavaScript 对象字面量（去掉引号）。

### 初始状态

```javascript
const user = {
  name: "John",
  age: 30,
  city: "NYC",
};
```

### 目标状态

```javascript
const user = {
  name: "John",
  age: 30,
  city: "NYC",
};
```

---

### 思路分析

1. 只处理值的引号（键已经没引号了）
2. 匹配 `"xxx":` 或 `"xxx": value`
3. 去除值上的引号

---

### 解法步骤

**方案 A：substitute**

```vim
:%s/"\([^"]*\)":/    \1:/g
```

**方案 B：列编辑**

```vim
" 步骤 1：定位到第一个引号
/\"<Enter>

" 步骤 2：进入列选
Ctrl-v

" 步骤 3：选中所有引号
7j

" 步骤 4：删除
x
```

**方案 C：外部命令**

```vim
:%!python -c "import re,sys; print(re.sub(r'\"(\w+)\":', r'    \1:', sys.stdin.read()))"
```

---

### 方案 A 详解

```vim
:%s/"\([^"]*\)":/    \1:/g
```

| 部分        | 含义                          |
| ----------- | ----------------------------- |
| `:%s`       | 全局替换                      |
| `"`         | 匹配双引号                    |
| `\([^"]*\)` | 捕获非引号内容                |
| `:`         | 匹配冒号                      |
| `\1:`   | 替换为 4 空格 + 捕获组 + 冒号 |

---

### 检验清单

- [ ] 能用正则匹配键名
- [ ] 理解捕获组的用法
- [ ] 知道替换时如何引用捕获组

---

## 组合题 04：批量重命名变量

> 难度：⭐⭐ | 类型：组合题 | 预估时间：3 分钟 | 分类：代码重构

### 场景描述

把代码中的 `data` 变量重命名为 `payload`，同时处理不同作用域。

### 初始状态

```javascript
function processData(data) {
  const data = getData();
  console.log(data);
  return data;
}

const data = 123;
console.log(data);
```

### 目标状态

```javascript
function processData(payload) {
  const payload = getData();
  console.log(payload);
  return payload;
}

const data = 123; // 保持不变（不同作用域）
console.log(data); // 保持不变
```

---

### 思路分析

1. 只重命名函数内部的 `data`
2. 保留全局的 `data` 不变

---

### 解法步骤

**步骤 1：定位到函数**

```vim
/processData<Enter>
```

**步骤 2：可视选中函数体**

```vim
vi{  " 选中花括号内
```

**步骤 3：替换**

```vim
:s/data/payload/g
```

**步骤 4：验证**

```vim
/data<Enter>
" 应该只找到函数外的
```

---

### 更安全的方法

**使用 LSP 重命名：**

```vim
<leader>rn
" 输入 payload
```

**检查引用：**

```vim
gr  " LSP 查找引用
```

---

### 检验清单

- [ ] 能使用可视模式选中范围
- [ ] 理解作用域的概念
- [ ] 知道 LSP 重命名的优势

---

## 组合题 05：给代码添加行号

> 难度：⭐ | 类型：组合题 | 预估时间：2 分钟 | 分类：格式调整

### 场景描述

给代码添加行号，用于文档或分享。

### 初始状态

```python
def hello():
    print("Hello")
    return True
```

### 目标状态

```python
1. def hello():
2.     print("Hello")
3.     return True
```

---

### 解法步骤

**方案 A：外部命令**

```vim
:%!nl -ba
```

**方案 B：substitute**

```vim
:%s/^/\=line('.').'. '/
```

**方案 C：手动（不推荐）**

---

### 方案 B 详解

```vim
:%s/^/\=line('.').'. '/
```

| 部分        | 含义     |
| ----------- | -------- |
| `:%s`       | 全局替换 |
| `^`         | 行首     |
| `\=`        | 表达式   |
| `line('.')` | 当前行号 |

---

### 进阶技巧

**带括号的行号：**

```vim
:%s/^/\='(' . line('.') . ') '/
```

**指定起始行号：**

```vim
:5,$s/^/\=line('.') - 4 . '. '/
```

---

### 检验清单

- [ ] 理解 `\=` 表达式替换
- [ ] 知道 `line('.')` 的含义
- [ ] 能自定义行号格式

---

# 第四部分：挑战题（2道）

## 挑战题 03：整理日志文件

> 难度：⭐⭐⭐ | 类型：挑战题 | 预估时间：5 分钟 | 分类：日志处理

### 场景描述

整理一份混乱的日志文件，提取关键信息。

### 初始状态

```
[2024-01-15 10:30:15] INFO: User login - user_id=1001
[2024-01-15 10:30:18] DEBUG: Cache miss - key=user:1001
[2024-01-15 10:30:20] ERROR: Database connection failed - error=timeout
[2024-01-15 10:30:22] WARN: Retry attempt 1/3
[2024-01-15 10:30:25] ERROR: Retry failed - attempt=1
[2024-01-15 10:30:30] INFO: Retry attempt 2/3
[2024-01-15 10:30:35] ERROR: Retry failed - attempt=2
[2024-01-15 10:30:40] INFO: Retry success
[2024-01-15 10:30:45] INFO: User logout - user_id=1001
```

### 目标状态

```
=== 错误日志 ===
[ERROR] Database connection failed - error=timeout
[ERROR] Retry failed - attempt=1
[ERROR] Retry failed - attempt=2

=== 警告日志 ===
[WARN] Retry attempt 1/3

=== 重试统计 ===
成功次数: 1
失败次数: 2
```

---

### 挑战要求

1. 提取所有 ERROR 日志
2. 统计重试成功/失败次数
3. 格式整洁，便于阅读

---

### 参考解法

**步骤 1：提取 ERROR**

```vim
:g/\[ERROR\]/yank A
```

**步骤 2：统计**

```vim
:let @s=0 | :let @f=0 | g/Retry/s/\(success\|failed\)/\=@s+=submatch(0)=='success'|@f+=submatch(0)=='failed'/ | en
```

**步骤 3：格式化**

```vim
" 手动组织格式
```

---

### 效率排名

| 解法      | 按键次数 | 可读性 |
| --------- | -------- | ------ |
| 纯命令    | ~20      | ⭐⭐   |
| 宏 + 命令 | ~15      | ⭐⭐⭐ |
| 外部脚本  | ~5       | ⭐⭐   |

---

### 思考题

1. 如何处理时间戳排序？
2. 如何提取特定字段（如 user_id）？
3. 如何生成 CSV 格式？

---

### 检验清单

- [ ] 能使用 `:g` 命令提取行
- [ ] 能统计匹配数量
- [ ] 能格式化输出

---

## 挑战题 04：代码迁移 - Vue 2 到 Vue 3

> 难度：⭐⭐⭐ | 类型：挑战题 | 预估时间：10 分钟 | 分类：代码迁移

### 场景描述

把 Vue 2 风格的组件转换为 Vue 3 组合式 API。

### 初始状态

```javascript
// UserList.vue
export default {
  data() {
    return {
      users: [],
      loading: false,
      error: null,
    };
  },
  methods: {
    async fetchUsers() {
      this.loading = true;
      try {
        const res = await fetch("/api/users");
        this.users = await res.json();
      } catch (e) {
        this.error = e.message;
      } finally {
        this.loading = false;
      }
    },
  },
  mounted() {
    this.fetchUsers();
  },
};
```

### 目标状态

```javascript
// UserList.vue
<script setup>
import { ref, onMounted } from 'vue';

const users = ref([]);
const loading = ref(false);
const error = ref(null);

async function fetchUsers() {
    loading.value = true;
    try {
        const res = await fetch('/api/users');
        users.value = await res.json();
    } catch (e) {
        error.value = e.message;
    } finally {
        loading.value = false;
    }
}

onMounted(() => {
    fetchUsers();
});
</script>
```

---

### 挑战要求

1. 把 `data()` 转换为 `ref`
2. 把 `methods` 转换为普通函数
3. 把 `mounted` 转换为 `onMounted`
4. 添加 `<script setup>` 标签

---

### 参考解法

**步骤 1：转换 data**

```vim
:%s/return {\n\(\s*\)\(\w\+\): \(\[\]\|null\)/const \2 = ref(\3)/
```

**步骤 2：转换 methods**

```vim
:%s/\s*\(\w\+\)(\(.*\)) {$/\1 = async (\2) => {/
```

**步骤 3：转换 mounted**

```vim
:%s/mounted() {/onMounted(() => {/
```

**步骤 4：添加 ref 前缀**

```vim
:%s/this\.\(\w\+\)/\1.value/g
```

---

### 效率排名

| 解法     | 按键次数 | 风险           |
| -------- | -------- | -------------- |
| 纯正则   | ~30      | 高（容易出错） |
| 分步骤   | ~50      | 中             |
| 插件辅助 | ~10      | 低             |

---

### 思考题

1. 如何处理 `computed`？
2. 如何处理 `watch`？
3. 如何处理 `props`？

---

### 检验清单

- [ ] 能使用复杂正则
- [ ] 能分步骤处理
- [ ] 能验证转换结果

---

# 第五部分：思维训练题（2道）

## 思维训练 03：理解 Vim 的模式

> 难度：⭐ | 类型：思维训练 | 预估时间：3 分钟 | 分类：模式理解

### 问题 1：模式切换

Vim 有多种模式，每种模式有不同的功能：

| 模式         | 进入方式     | 主要功能   |
| ------------ | ------------ | ---------- |
| Normal       | `Esc`        | 导航、命令 |
| Insert       | `i/a/o`      | 输入文本   |
| Visual       | `v/V/Ctrl-v` | 选中区域   |
| Command-line | `:`          | 执行命令   |

**思考题 1-1：** 当前在 Insert 模式，想执行一个 Normal 模式命令，应该先按什么？

<details>
<summary>答案</summary>

`Esc` 或 `Ctrl-[`

</details>

**思考题 1-2：** 在 Normal 模式下快速进入 Insert 模式，有几种方式？分别是什么？

<details>
<summary>答案</summary>

- `i` - 在光标前插入
- `I` - 在行首插入
- `a` - 在光标后插入
- `A` - 在行尾插入
- `o` - 在下方插入新行
- `O` - 在上方插入新行

</details>

---

### 问题 2：模式指示器

Vim 底部会显示当前模式：

| 显示                 | 含义        |
| -------------------- | ----------- |
| `-- INSERT --`       | 插入模式    |
| `-- VISUAL --`       | 字符可视    |
| `-- VISUAL LINE --`  | 行可视      |
| `-- VISUAL BLOCK --` | 列可视      |
| 空                   | Normal 模式 |

**思考题 2-1：** 底部显示 `-- INSERT --`，你按了 `v`，现在显示什么？

<details>
<summary>答案</summary>

`-- VISUAL --`（字符可视）

</details>

---

### 问题 3：为什么需要模式？

**思考题 3-1：** 为什么 Vim 不像其他编辑器一样直接输入，而是要用模式？

<details>
<summary>答案</summary>

1. **减少手指移动**：不需要频繁移动到功能键
2. **组合操作**：动词+名词的命令模式
3. **效率**：熟练后可以盲操作
4. **减少 Ctrl 键使用**：不像 IDE 那样依赖组合键

</details>

---

### 检验清单

- [ ] 知道 Vim 有哪些模式
- [ ] 知道如何切换模式
- [ ] 理解模式切换的指示器

---

## 思维训练 04：理解寄存器

> 难度：⭐⭐ | 类型：思维训练 | 预估时间：5 分钟 | 分类：寄存器

### 问题 1：默认寄存器

当你执行 `yy` 或 `dd` 时，内容被复制到哪个寄存器？

<details>
<summary>答案</summary>

默认寄存器 `"`（双引号）

</details>

**验证方法：**

```vim
:reg "
```

---

### 问题 2：寄存器类型

| 寄存器 | 说明         | 示例                     |
| ------ | ------------ | ------------------------ |
| `"`    | 默认寄存器   | `yy`, `dd`               |
| `0`    | 最近复制     | `yy`（不覆盖 `dd` 内容） |
| `1`    | 最近删除     | `dd`, `x`                |
| `a-z`  | 命名寄存器   | `"ayy`, `"ap`            |
| `/`    | 搜索寄存器   | 最后搜索内容             |
| `:`    | 命令寄存器   | 最后命令                 |
| `%`    | 文件名寄存器 | 当前文件名               |

**思考题 2-1：** 先 `dd` 再 `yy`，现在：

- `"` 寄存器内容是？
- `0` 寄存器内容是？
- `1` 寄存器内容是？

<details>
<summary>答案</summary>

- `"` = yy 的内容
- `0` = yy 的内容
- `1` = dd 的内容

</details>

---

### 问题 3：如何使用命名寄存器

**复制到指定寄存器：**

```vim
"ayy  " 复制到 a 寄存器
```

**从指定寄存器粘贴：**

```vim
"ap  " 粘贴 a 寄存器内容
```

**思考题 3-1：** 如何把多段内容依次粘贴？

<details>
<summary>答案</summary>

```vim
"ayy  " 复制第一段到 a
"byy  " 复制第二段到 b
...
"ap   " 粘贴 a
"bp   " 粘贴 b
```

</details>

---

### 问题 4：黑洞寄存器

```vim
"_d  " 删除到黑洞寄存器（不覆盖默认寄存器）
```

**思考题 4-1：** 什么时候用黑洞寄存器？

<details>
<summary>答案</summary>

当你想删除内容，但不想覆盖 `"` 或 `"1` 寄存器时

</details>

---

### 检验清单

- [ ] 知道默认寄存器是 `"`
- [ ] 理解 `0` 和 `1` 的区别
- [ ] 能使用命名寄存器
- [ ] 知道黑洞寄存器的用途

---

# 附录：答案汇总

## 对比题答案

### 对比题 03

- 字符可视：`v`
- 行可视：`V`
- 列可视：`Ctrl-v`

### 对比题 04

- 双引号内：`ci"`
- 单引号内：`ci'`

### 对比题 05

- 向下搜索： `/`
- 向上搜索： `?`

## 纠错题答案

### 纠错题 03

- `%` 匹配括号对 `() [] {}`

### 纠错题 04

- `u` = 撤销
- `Ctrl-r` = 重做
- 新编辑会清除重做栈

### 纠错题 05

- `i` = 当前字符前
- `a` = 当前字符后

## 组合题答案

### 组合题 03

```vim
:%s/"\([^"]*\)":/    \1:/g
```

### 组合题 04

```vim
vi{
:s/data/payload/g
```

### 组合题 05

```vim
:%s/^/\=line('.').'. '/
```

## 挑战题答案

### 挑战题 03

使用 `:g` 提取，配合统计

### 挑战题 04

分步骤替换，最后验证

## 思维训练答案

### 思维训练 03

| 问题 | 答案              |
| ---- | ----------------- |
| 1-1  | `Esc` 或 `Ctrl-[` |
| 1-2  | `i/I/a/A/o/O`     |
| 2-1  | `-- VISUAL --`    |

### 思维训练 04

| 问题 | 答案             |
| ---- | ---------------- |
| 1-1  | `"`              |
| 2-1  | 见上表           |
| 3-1  | 使用命名寄存器   |
| 4-1  | 不想覆盖寄存器时 |

---

> **提示**：建议配合视频学习，每道题先思考再看答案。
