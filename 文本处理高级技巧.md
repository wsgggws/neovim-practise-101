# 文本处理高级技巧

## 139. 文本对齐和排版

**场景**：对齐变量声明和赋值

**初始文本**：

```javascript
const name = "John";
const age = 30;
const email = "john@example.com";
const address = "123 Main St";
```

**目标**：

```javascript
const name = "John";
const age = 30;
const email = "john@example.com";
const address = "123 Main St";
```

**操作提示**：

- 使用 `vim-easy-align` 插件
- 选中行后，`ga=` 按 = 对齐
- 或使用 `:Tabularize /=` 命令

## 140. 列编辑和块操作

**场景**：在多行相同位置插入或修改内容

**初始文本**：

```text
apple
banana
cherry
date
```

**目标**：

```text
1. apple
2. banana
3. cherry
4. date
```

**操作提示**：

- `Ctrl-v` 进入可视块模式
- 选择列
- `I` 在开头插入，`A` 在末尾追加
- 输入内容后 `Esc` 应用到所有行

**更多列编辑示例**：

**任务**：添加引号

```text
apple      =>    "apple"
banana     =>    "banana"
```

**操作**：

1. `Ctrl-v` 选择列
2. `I"` 插入开引号
3. `Esc` 应用
4. `Ctrl-v` 选择末尾
5. `A"` 添加结束引号
6. `Esc` 应用

## 141. 表达式寄存器计算

**场景**：在文本中插入计算结果

**示例 1：插入计算结果**

**初始**：

```text
Total:
```

**操作**：
在插入模式下，`Ctrl-r` 然后 `=` 输入表达式 `125 * 3`

**目标**：

```text
Total: 375
```

**示例 2：批量计算**

**初始文本**：

```text
Item 1: $10 x 3 =
Item 2: $25 x 2 =
Item 3: $15 x 5 =
```

**目标**：

```text
Item 1: $10 x 3 = $30
Item 2: $25 x 2 = $50
Item 3: $15 x 5 = $75
```

## 142. 文本转换和大小写处理

**场景**：复杂的文本格式转换

**示例：将对象转为解构赋值**

**初始**：

```javascript
const user = {
  name: "John",
  age: 30,
  email: "john@example.com",
};
```

**目标**：

```javascript
const { name, age, email } = user;
```

**示例 2：驼峰转蛇形**

**初始**：

```text
getUserName
getEmailAddress
setPhoneNumber
```

**目标**：

```text
get_user_name
get_email_address
set_phone_number
```

**操作提示**：

- 使用正则替换：`:%s/\([a-z]\)\([A-Z]\)/\1_\l\2/g`
- 或使用 `vim-abolish` 插件的 `:Abolish` 命令

## 143. 智能换行和合并

**场景**：调整文本的换行方式

**示例：将长行按宽度自动换行**

**初始**：

```text
This is a very long line that should be wrapped to multiple lines for better readability and easier editing in the terminal or editor window.
```

**目标（80 字符宽度）**：

```text
This is a very long line that should be wrapped to multiple lines for better
readability and easier editing in the terminal or editor window.
```

**操作提示**：

- `:set textwidth=80` 设置文本宽度
- `gqq` 格式化当前行
- `gqip` 格式化当前段落
- `gqG` 格式化到文件末尾

**示例 2：智能合并行**

**初始**：

```text
const message = 'Hello ' +
  'World ' +
  'from ' +
  'JavaScript';
```

**目标**：

```text
const message = 'Hello World from JavaScript';
```

**操作**：选中后 `J` 连接行

## 144. 文本包裹和引用

**场景**：为文本添加包裹符号或引用格式

**示例 1：添加 Markdown 引用**

**初始**：

```text
This is important.
Remember this.
Key point here.
```

**目标**：

```markdown
> This is important.
> Remember this.
> Key point here.
```

**操作提示**：

- 选中行 `:'<,'>s/^/> /`
- 或使用宏录制批量添加

**示例 2：包裹 HTML 标签**

**初始**：

```text
Hello World
```

**目标**：

```html
<div class="container">Hello World</div>
```

**操作提示**：

- 使用 `vim-surround` 插件
- `ysiwt` 然后输入标签名

## 145. 文本排序和去重进阶

**场景**：复杂的排序和去重需求

**示例 1：按长度排序**

**初始**：

```text
JavaScript
Go
TypeScript
Rust
Python
```

**目标（按长度升序）**：

```text
Go
Rust
Python
JavaScript
TypeScript
```

**操作提示**：
使用外部命令：`:%!awk '{ print length, $0 }' | sort -n | cut -d' ' -f2-`

**示例 2：按数字排序**

**初始**：

```text
Item 10
Item 2
Item 30
Item 1
```

**目标**：

```text
Item 1
Item 2
Item 10
Item 30
```

**操作提示**：

- `:sort n` - 数字排序
- 选中后 `:'<,'>sort n`

**示例 3：保持顺序去重（只删除连续重复）**

**初始**：

```text
apple
apple
banana
apple
banana
```

**目标**：

```text
apple
banana
apple
banana
```

**操作提示**：
使用 Vim 脚本：

```vim
:g/^\(.*\)$\n\1$/d
```

## 146. 文本分割和提取

**场景**：从复杂文本中提取信息

**示例 1：提取邮箱域名**

**初始**：

```text
john@gmail.com
jane@yahoo.com
bob@outlook.com
```

**目标**：

```text
gmail.com
yahoo.com
outlook.com
```

**操作提示**：

```vim
:%s/.*@\(.*\)/\1/
```

**示例 2：分割 CSV 到列**

**初始**：

```text
Name,Age,City
John,30,NYC
Jane,25,LA
```

**目标**：

```text
Name    Age    City
John    30     NYC
Jane    25     LA
```

**操作提示**：

```vim
:%s/,/\t/g
```

然后使用 `:Tabularize /\t` 对齐

## 147. 增量数字和序列

**场景**：生成数字序列或增量编号

**示例 1：生成连续编号**

**初始**：

```text
Item
Item
Item
Item
```

**目标**：

```text
Item 1
Item 2
Item 3
Item 4
```

**操作提示**：

1. 在第一行输入 `Item 1`
2. `qa` 开始录制宏到 a
3. `yyp` 复制并粘贴
4. `Ctrl-a` 增加数字
5. `q` 停止录制
6. `3@a` 重复 3 次

**或使用插件**：

- `vim-visual-increment` 插件
- 选中列后 `g Ctrl-a`

**示例 2：生成带格式的序列**

**目标**：

```text
ID-001
ID-002
ID-003
...
ID-100
```

**操作提示**：
使用 Vim 脚本：

```vim
:put =map(range(1,100), 'printf(''ID-%03d'', v:val)')
```

## 148. 文本差异和比较

**场景**：比较两段文本的差异

**示例：比较两个版本的代码**

**版本 1（buffer 1）**：

```javascript
function hello() {
  console.log("Hello");
}
```

**版本 2（buffer 2）**：

```javascript
function hello(name) {
  console.log("Hello " + name);
}
```

**操作提示**：

- `:windo diffthis` - 在所有窗口启动 diff 模式
- `:diffoff` - 退出 diff 模式
- `]c` - 跳到下一个差异
- `[c` - 跳到上一个差异
- `do` - diff obtain（从另一个窗口获取）
- `dp` - diff put（推送到另一个窗口）

## 149. 文本加密和编码

**场景**：简单的文本加密或编码转换

**Base64 编码**

**初始**：

```text
Hello World
```

**目标**：

```text
SGVsbG8gV29ybGQ=
```

**操作提示**：
选中后执行：`:'<,'>!base64`

**Base64 解码**：
`:'<,'>!base64 -d`

**ROT13 加密**：
`:'<,'>!tr 'A-Za-z' 'N-ZA-Mn-za-m'`

## 150. 模式匹配和捕获组

**场景**：使用正则捕获组重组文本

**示例：交换日期格式**

**初始**：

```text
2024-12-28
2024-01-15
2023-11-20
```

**目标**：

```text
28/12/2024
15/01/2024
20/11/2023
```

**操作提示**：

```vim
:%s/\(\d\{4\}\)-\(\d\{2\}\)-\(\d\{2\}\)/\3\/\2\/\1/
```

**示例 2：重组 URL**

**初始**：

```text
https://api.example.com/users/123
https://api.example.com/posts/456
```

**目标**：

```text
User: 123 (https://api.example.com)
Post: 456 (https://api.example.com)
```

**操作提示**：

```vim
:%s#https://\(.*\)/\(.*\)/\(.*\)#\u\2: \3 (https://\1)#
```

## 151. 动态文本生成

**场景**：根据模式生成重复文本

**示例：生成测试数据**

**目标**：

```javascript
const user1 = { id: 1, name: 'User1' };
const user2 = { id: 2, name: 'User2' };
const user3 = { id: 3, name: 'User3' };
...
const user10 = { id: 10, name: 'User10' };
```

**操作提示**：
使用 Vim 脚本：

```vim
:for i in range(1, 10) | put ='const user'.i.' = { id: '.i.', name: ''User'.i.''' };' | endfor
```

**示例 2：生成 SQL 插入语句**

**目标**：

```sql
INSERT INTO users (name, email) VALUES ('User1', 'user1@example.com');
INSERT INTO users (name, email) VALUES ('User2', 'user2@example.com');
...
```

**操作提示**：

```vim
:for i in range(1, 50) | put ='INSERT INTO users (name, email) VALUES (''User'.i.''', ''user'.i.'@example.com'');' | endfor
```
