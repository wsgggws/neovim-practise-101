# 宏录制 (54-56)

> ⭐⭐ 中等 | 分类：批量操作 | 预估时间：3 分钟

### 场景描述

宏录制是 Vim 的强大功能，可以录制一系列操作并重复执行。

---

## 54. 批量格式化行

> 难度：⭐⭐ | 预估时间：1 分钟

### 初始状态

```text
name:John
age:30
city:NYC
```

### 目标状态

```text
Name: John
Age: 30
City: NYC
```

---

### 操作方法

**步骤 1：录制宏**

```vim
qa          " 开始录制到寄存器 a
I           " 行首插入
Name:       " 输入 Name:
<Esc>       " 返回 Normal
l           " 右移到冒号后
cw30<Esc>   " 修改数字
j           " 下一行
q           " 停止录制
```

**步骤 2：执行宏**

```vim
2@a  " 执行 2 次
```

---

### 关键命令解析

| 命令 | 作用          |
| ---- | ------------- |
| `qa` | 开始录制到 a  |
| `q`  | 停止录制      |
| `@a` | 执行 a 寄存器 |
| `@@` | 执行上次宏    |

---

### 常见错误

- ❌ 宏录制时位置不一致
- ✅ 确保每步操作后回到相同位置

---

### 检验清单

- [ ] 知道如何录制和执行宏
- [ ] 理解寄存器 a 的使用

---

## 55. 重复模式操作

> 难度：⭐⭐ | 预估时间：1 分钟

### 初始状态

```text
function1
function2
function3
```

### 目标状态

```python
def function1():
    pass

def function2():
    pass

def function3():
    pass
```

---

### 操作方法

```vim
qa
Idef <Esc>
ea():<Esc>
A
    pass<Esc>
k0
j
q
2@a
```

---

### 关键命令解析

| 命令 | 作用         |
| ---- | ------------ |
| `I`  | 行首插入     |
| `A`  | 行尾追加     |
| `k0` | 回到上行行首 |

---

### 检验清单

- [ ] 能设计宏的步骤
- [ ] 知道如何处理多行

---

## 56. 批量处理数据

> 难度：⭐⭐ | 预估时间：1 分钟

### 初始状态

```text
1. apple
2. banana
3. cherry
```

### 目标状态

```text
1. Apple - Fruit
2. Banana - Fruit
3. Cherry - Fruit
```

---

### 操作方法

```vim
qa
$           " 行尾
i - Fruit<Esc>
j0          " 下一行行首
q
2@a
```

---

### 进阶扩展

**录制宏的黄金法则：**

1. 宏结束时回到相同位置
2. 确保光标移动一致
3. 先在测试行验证

---

### 检验清单

- [ ] 能设计批量操作的宏
- [ ] 理解宏录制的注意事项

---

## 宏录制速查

| 操作     | 命令     | 说明          |
| -------- | -------- | ------------- |
| 开始录制 | `qa`     | 录制到 a      |
| 停止录制 | `q`      |               |
| 执行宏   | `@a`     | 执行 a 寄存器 |
| 重复执行 | `n@a`    | 执行 n 次     |
| 查看宏   | `:reg a` | 查看内容      |

---

### 视频时间点

- **0:00** - 题目介绍
- **0:20** - 演示第 54 题
- **1:00** - 演示第 55 题
- **1:45** - 演示第 56 题
- **2:30** - 速查表

---

> **提示**：使用 `:let @a='...'` 可以直接编辑宏内容。
